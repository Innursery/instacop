<!--**************************************************************************************

instructions:
- edit host file via 'sudo nano /private/etc/hosts' and route 127.0.0.1 to x.adidas.com
- unzip the folder to /Library/WebServer/Documents/
- enable php via 'sudo nano /etc/apache2/httpd.conf'
- start apache server via 'sudo apachectl start' and go to x.adidas.com
- update sitekey at runtime: x.adidas.com/?sitekey=xxxxx

(c) 2017 twitter.com/InstaCopV2 twitter.com/bqdxo

***************************************************************************************-->

<!DOCTYPE html>

<html>

	<head>

		<meta charset="utf-8">

		<!--meta name="referrer" content="no-referrer"-->

		<title>InstaCop V2</title>

		<!-- jQuery, reCAPTCHA, Bootstrap, js.cookie, jq.countdown, json2html, instacop -->

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

		<script src='https://www.google.com/recaptcha/api.js'></script>

		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

		<script src='https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.1.3/js.cookie.js'></script>

		<script src="instacop/jquery.countdown.js"></script>

		<script src="instacop/json2html.js"></script>
		<script src="instacop/jquery.json2html.js"></script>

		<script src="instacop/instacop.js"></script>
		<link rel="stylesheet" href="instacop/instacop.css">

	</head>


	<body class="beluga-fg steeple-bg">


		<form action="" method="post" target="cart_frame" hidden="true" id="post_form" name="addProductForm">

			<input name="layer" value="Add To Bag overlay">
			<input name="pid" value="" id="post_pid">
			<input name="Quantity" value="1">
			<input name="g-recaptcha-response" value="" id="post_token">
			<input name="x-PrdRt" value="" id="post_xpr">
			<input name="masterPid" value="" id="post_mpid">
			<input name="sessionSelectedStoreID" value="null">
			<input name="responseformat" value="json" disabled="disabled">
			<input name="ajax" value="true">

		</form>

		<form action="" method="post" target="cart_frame" hidden="true" id="post_form_serialized" name="addProductForm"></form>

		<form action="" method="post" target="hmac_frame" hidden="true" id="hmac_form"></form>

		<iframe src="" hidden="true" id="hmac_frame" name="hmac_frame"></iframe>


		<div class="container">

			<header class="header"><h2>InstaCop <span class="solar-fg">V2</span></h2></header>

			<div class="row main">

				<div class="col-lg-4 col-sm-6">

					<h4><span class="label beluga-bg">Settings</span></h4>

					<div class="row captcha-w-row">

						<div class="form-group col-sm-6">

							<label for="user_locale">Locale &nbsp;<span class="caret"></span></label>
							<div class="pull-right">Default</div>

							<div class="input-group">

								<select class="form-control input-select" id="user_locale">

									<optgroup label="Oceania">
										<option   data-domain="com.au"   value="AU"   data-lang="en_AU"   >Australia</option>
										<option   data-domain="co.nz"    value="NZ"   data-lang="en_NZ"   >New Zealand</option>
									</optgroup>
									<optgroup label="Europe">
										<option   data-domain="at"       value="AT"   data-lang="de_AT"   >Austria</option>
										<option   data-domain="be"       value="BE"   data-lang="fr_BE"   >Belgium</option>
										<option   data-domain="cz"       value="CZ"   data-lang="cs_CZ"   >Czech Republic</option>
										<option   data-domain="dk"       value="DK"   data-lang="da_DK"   >Denmark</option>
										<option   data-domain="fi"       value="FI"   data-lang="fi_FI"   >Finland</option>
										<option   data-domain="fr"       value="FR"   data-lang="fr_FR"   >France</option>
										<option   data-domain="de"       value="DE"   data-lang="de_DE"   >Germany</option>
										<option   data-domain="ie"       value="IE"   data-lang="en_IE"   >Ireland</option>
										<option   data-domain="it"       value="IT"   data-lang="it_IT"   >Italy</option>
										<option   data-domain="nl"       value="NL"   data-lang="nl_NL"   >Netherlands</option>
										<option   data-domain="pl"       value="PL"   data-lang="pl_PL"   >Poland</option>
										<option   data-domain="es"       value="ES"   data-lang="es_ES"   >Spain</option>
										<option   data-domain="se"       value="SE"   data-lang="sv_SE"   >Sweden</option>
										<option   data-domain="co.uk"    value="GB"   data-lang="en_GB"   >United Kingdom</option>
									</optgroup>
									<optgroup label="America">
										<option   data-domain="com"      value="US"   data-lang="en_US"   >United States</option>
										<option   data-domain="ca"       value="CA"   data-lang="en_CA"   >Canada</option>
										<option   data-domain="mx"       value="MX"   data-lang="es_MX"   >Mexico</option>
										<option   data-domain="com.br"   value="BR"   data-lang="pt_BR"   >Brazil</option>
									</optgroup>

								</select>

								<span class="input-group-addon"> 
									<input type="checkbox" id="default_check" value="">
								</span>

							</div>

						</div>

						<div class="form-group col-sm-6">

							<label for="pid_style">Product</label>

							<div class="input-group">

								<input class="form-control" id="pid_style" type="text" placeholder="XX0000" value=" ">
								<span class="input-group-btn">
									<button class="form-control btn btn-default" id="pid_img" onclick="$('#pid_style').change();">-</button>
								</span>

							</div>

						</div>

					</div>

					<div class="row captcha-w-row">
						
						<div class="form-group col-sm-6">

							<label for="xpr_val">x-PrdRt</label>
							<div class="pull-right">Serialize</div>

							<div class="input-group">

								<input class="form-control" id="xpr_val" type="text" placeholder="XxXXX0xxX" value=" ">

								<span class="input-group-addon"> 
									<input type="checkbox" id="serialize_check" value="">
								</span>
								
							</div>

						</div>

						<div class="form-group col-sm-6">

							<label for="pid_size">Size</label>

							<div class="input-group">

								<input class="form-control" id="pid_size" type="text" placeholder="000" value=" ">

								<span class="input-group-btn">
									<button class="btn btn-default" id="size_add" onclick="addToCart($('#pid_size').val());">Add</button>
								</span>
								
							</div>

						</div>

					</div>

					<div class="spacer"></div>

					<h4><span class="label beluga-bg">Captcha</span></h4>

					<div class="form-group captcha-w">

						<label for="site_key">Sitekey</label>

						<div class="pull-right">
							<span class="badge btn-bg beluga-fg invisible" id="token_timer"></span>
							<span class="badge btn-bg beluga-fg pointer" id="token_status" onclick="prompt('Copy this!',getToken());">Tokens: 0</span>
						</div>

						<input class="form-control steeple-bg" id="site_key" type="text" readonly="true">

					</div>

					<div class="g-recaptcha" id="g_captcha" data-sitekey="" data-callback="addToken"></div>

					<script> //thank you @bapeyeezy!

						function addSiteKey() {

							var defaultKey = '6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI';

							var siteKey = location.search.substring(1).split('&')[0].split('=')[1];

							if ((siteKey == null) || (siteKey == '')) {
								siteKey = defaultKey;
							}

							document.getElementById('g_captcha').setAttribute('data-sitekey', siteKey);
							document.getElementById('site_key').value = siteKey;

						}

						addSiteKey();

					</script>

					<div class="spacer"></div>
					<div class="spacer"></div>
					<div class="spacer-sm"></div>

					<h4><span class="label beluga-bg">Splash</span></h4>

					<div class="form-group captcha-w">

						<div class="input-group">

							<input class="form-control" id="splash_txt" type="text" placeholder="SplashATC bookmarklet.">

							<div class="input-group-btn">
								<button class="btn btn-default" onclick="generateSplash();">Data</button>
								<button class="btn btn-default" onclick="openSplash();">Open</a>
							</div>

						</div>

					</div>

				</div>


				<div class="col-lg-4 col-sm-6">

					<h4><span class="label beluga-bg">Inventory ATC</span></h4>

					<div class="form-group captcha-w">

						<label for="client_id">Client ID</label>
						<span class="badge btn-bg beluga-fg pull-right" id="stock_status"></span>

						<div class="input-group">

							<input class="form-control" id="client_id" type="text" placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" value=" ">

							<span class="input-group-btn">
								<button class="btn btn-default" onclick="loadStock();">
									<span class="glyphicon glyphicon-refresh" id="stock_gif"></span>
								</button>>
							</span>

						</div>

					</div>

					<table class="table table-hover table-condensed form-bg captcha-w">

						<colgroup>
							<col width="15%">
							<col width="25%">
							<col width="15%">
							<col width="15%">
							<col width="30%">
						</colgroup>
						<thead>
							<tr>
								<th>Size</th>
								<th id="table_location"></th>
								<th class="text-right">Stock</th>
								<th class="text-right" id="table_total"></th>
								<th></th>
							</tr>
						</thead>
						<tbody id="stock_table">
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
						</tbody>

					</table>

				</div>


				<div class="col-lg-4 col-sm-12">

					<h4><span class="label beluga-bg">adidas.com</span></h4>

					<div class="row">

						<div class="form-group col-sm-6">

							<label for="cart_buttons">Cart</label>

							<div class="btn-group input-group" role="group">
								<button class="btn btn-default" name="cart_buttons" onclick="goToADC('show');">Show</button>
								<button class="btn btn-default" name="cart_buttons" onclick="goToADC('paypal');">PayPal</button>
							</div>

						</div>

						<div class="form-group col-sm-6">

							<div class="pull-right">

								<label for="client_timer">Account</label>
								
								<div class="btn-group input-group" role="group">
									<button class="btn btn-default" name="cart_buttons" onclick="goToADC('login');">Login</button>
									<button class="btn btn-default" name="cart_buttons" onclick="goToADC('logout');">Logout</button>
								</div>

							</div>

						</div>

					</div>

					<iframe class="form-control" id="cart_frame" name="cart_frame"></iframe>

				</div>

			</div>


			<footer class="footer solar-bg">

				&copy; 2017 &mdash; v2.5.1 &mdash; <a href="http://twitter.com/InstaCopV2" target="_blank">InstaCop on Twitter</a> &mdash; <a href="http://twitter.com/bqdxo" target="_blank">@bq</a> &mdash; @bapeyeezy &mdash; Bookmarklets:

				<a href="javascript:prompt('Copy this!',document.getElementsByClassName('g-recaptcha')[0].getAttribute('data-sitekey'));void(0);">SiteKey</a>, 

				<a href="javascript:prompt('Copy this!',window.OCAPI_KEY);void(0);">ClientID</a>,

				<a href="

					javascript: (function () {

						var data = prompt('Paste request data:').split('&');

						var sitekey = data[0];
						var link = 'https://www.adidas.' + data[1] + '/on/demandware.store/Sites-adidas-' + data[2] + '-Site/' + data[3] + '/Cart-MiniAddProduct';
						var pid = data[4] + '_' + data[5];
						var mpid = data[4];
						var xpr = data[6];


						var script1 = document.createElement('script');
						var script2 = document.createElement('script');

						var view = document.createElement('div');
						var div = document.createElement('div');
						var iframe = document.createElement('iframe');
						var form = document.createElement('form');

						var input1 = document.createElement('input');
						var input2 = document.createElement('input');
						var input3 = document.createElement('input');
						var input4 = document.createElement('input');
						var input5 = document.createElement('input');
						var input6 = document.createElement('input');
						var input7 = document.createElement('input');
						var input8 = document.createElement('input');


						script1.src = 'https://www.google.com/recaptcha/api.js';
						document.body.appendChild(script1);

						script2.text = 'function captchaCallback() { document.getElementById(\'captchaToken\').value = grecaptcha.getResponse(); document.getElementById(\'xprToken\').value = grecaptcha.getResponse(); document.getElementById(\'atcForm\').submit(); grecaptcha.reset(); }';
						document.body.appendChild(script2);

						div.className = 'g-recaptcha';
						div.setAttribute('data-sitekey', sitekey);
						div.setAttribute('data-callback', 'captchaCallback');

						iframe.name = 'frame';
						iframe.style.width = '500px';
						iframe.style.height = '500px';
						iframe.style.backgroundColor = '#f9f9f9';

						form.name = 'addProductForm';
						form.id = 'atcForm';
						form.method = 'post';
						form.action = link;
						form.target = 'frame';

						view.appendChild(div);
						view.appendChild(form);
						view.appendChild(iframe);

						if (document.getElementsByTagName('header')[0] != null) {
							document.getElementsByTagName('header')[0].insertAdjacentElement('afterend' ,view);
						} else {
							document.body.appendChild(view);
						}

						input1.name = 'layer';
						input1.value = 'Add To Bag overlay';
						form.appendChild(input1);

						input2.name = 'pid';
						input2.value = pid;
						form.appendChild(input2);

						input3.name = 'Quantity';
						input3.value = '1';
						form.appendChild(input3);

						input4.name = 'g-recaptcha-response';
						input4.id = 'captchaToken';
						input4.value = '';
						form.appendChild(input4);

						input5.name = xpr;
						input5.id = 'xprToken';
						input5.value = '';
						if (xpr == '') {input5.disabled = true;}
						form.appendChild(input5);

						input6.name = 'masterPid';
						input6.value = mpid;
						form.appendChild(input6);

						input7.name = 'sessionSelectedStoreID';
						input7.value = 'null';
						form.appendChild(input7);

						input8.name = 'ajax';
						input8.value = 'true';
						form.appendChild(input8);

					})();

					">SplashATC</a>

			</footer>

		</div>


		<script>

			// ------- INITIALIZE ------------------------------------------------------------------------------------------------- //

			var locDomain = '';
			var locCountry = '';
			var locLang = '';

			var tokenArray = [];

			var clientStock = [];
			var clientCache = [];

			var sizeChartLocale = 'US';
			var sizeChart = [
				{szc:'530', size:'4', stock:'?', change:''},
				{szc:'540', size:'4.5', stock:'?', change:''},
				{szc:'550', size:'5', stock:'?', change:''},
				{szc:'560', size:'5.5', stock:'?', change:''},
				{szc:'570', size:'6', stock:'?', change:''},
				{szc:'580', size:'6.5', stock:'?', change:''},
				{szc:'590', size:'7', stock:'?', change:''},
				{szc:'600', size:'7.5', stock:'?', change:''},
				{szc:'610', size:'8', stock:'?', change:''},
				{szc:'620', size:'8.5', stock:'?', change:''},
				{szc:'630', size:'9', stock:'?', change:''},
				{szc:'640', size:'9.5', stock:'?', change:''},
				{szc:'650', size:'10', stock:'?', change:''},
				{szc:'660', size:'10.5', stock:'?', change:''},
				{szc:'670', size:'11', stock:'?', change:''},
				{szc:'680', size:'11.5', stock:'?', change:''},
				{szc:'690', size:'12', stock:'?', change:''},
				{szc:'700', size:'12.5', stock:'?', change:''},
				{szc:'710', size:'13', stock:'?', change:''},
				{szc:'720', size:'13.5', stock:'?', change:''},
				{szc:'730', size:'14', stock:'?', change:''}
			];

			$(document).ready(function() {

				if (Cookies.get('InstaCopLocale') != null) {
					$('#user_locale').val(Cookies.get('InstaCopLocale'));
				}

				locDomain = $('#user_locale option:selected').data('domain');
				locCountry = $('#user_locale option:selected').val();
				locLang = $('#user_locale option:selected').data('lang');


				$('#pid_style').val('BY1604');
				$('#pid_size').val('660');
				$('#client_id').val('2904a24b-e4b4-4ef7-89a4-2ebd2d175dde');
				$('#xpr_val').val('DhnjhrCA');
				$('#hmac_page').val('http://www.adidas.com/ca/apps/yeezy/');


				/*if (document.domain == '127.0.0.1') {
					$('#client_timer').prop('disabled', true);
				}*/


				buildStock(sizeChart);
				$('#table_location').html(sizeChartLocale);

				loadPidImg();

				$('#token_timer').countdown({
					date: Date.now(),
					render: function(data) {
						$(this.el).html(this.leadingZeros(data.min, 1) + "m " + this.leadingZeros(data.sec, 2) + "s");
					},
					onEnd: function() {
						clearTokens();
					}

				});

			});

			$('#user_locale').change(function() {

				locDomain = $('#user_locale option:selected').data('domain');
				locCountry = $('#user_locale option:selected').val();
				locLang = $('#user_locale option:selected').data('lang');

				if ($('#default_check').is(':checked')) {
					locLang = 'default';
				}

				Cookies.set('InstaCopLocale', locCountry, {
					expires: 30,
					path: '',
					domain: document.domain
				});

			});

			$('#default_check').change(function() {

				if ($('#default_check').is(':checked')) {
					locLang = 'default';
				} else {
					locLang = $('#user_locale option:selected').data('lang');
				}

			})

			$('#pid_style').change(function() {
				loadPidImg();
			})
			$('#pid_style').keyup(function() {
				loadPidImg();
			})

		</script>

	</body>

</html>